<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>D&E LIVE TV</title>
  <link rel="stylesheet" href="style.css">
  <script src="table.js" defer></script>
</head>
<body>
  <h1>D&E LIVE TV</h1>
  <video id="remoteVideo" autoplay playsinline controls style="width:90%; border:2px solid red;"></video>
  <div id="breaking"></div>
  <div id="ltTitle"></div>
  <div id="ltSub"></div>
  <div id="ticker"></div>

  <script defer>
    window.addEventListener('DOMContentLoaded', () => {
      const video = document.getElementById('remoteVideo');
      const ws = new WebSocket('wss://de-live-tv-signaling.onrender.com'); // <- Replace
      const pc = new RTCPeerConnection();
      const viewerId = Math.floor(Math.random()*1000000);

      ws.onopen = () => ws.send(JSON.stringify({type:'watcher', id:viewerId}));

      ws.onmessage = async msg => {
        const data = JSON.parse(msg.data);
        switch(data.type){
          case 'offer':
            await pc.setRemoteDescription(new RTCSessionDescription(data.sdp));
            const answer = await pc.createAnswer();
            await pc.setLocalDescription(answer);
            ws.send(JSON.stringify({type:'answer', sdp:answer, id:data.id}));
            break;
          case 'candidate':
            await pc.addIceCandidate(new RTCIceCandidate(data.candidate));
            break;
        }
      };

      pc.ontrack = e => video.srcObject = e.streams[0];

      setInterval(() => {
        const state = getLiveState();
        document.getElementById('breaking').textContent = state.breaking;
        document.getElementById('ltTitle').textContent = state.lt_title;
        document.getElementById('ltSub').textContent = state.lt_sub;
        document.getElementById('ticker').textContent = state.ticker;
      }, 500);
    });
  </script>
</body>
</html>
