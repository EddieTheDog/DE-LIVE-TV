<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Control Panel</title>
  <link rel="stylesheet" href="../style.css">
  <script src="../table.js" defer></script>
</head>
<body>
  <h1>Control Panel</h1>
  <button onclick="sendControl('start')">Start Broadcast</button>
  <button onclick="sendControl('stop')">Stop Broadcast</button><br><br>

  <label>Breaking News:</label><br>
  <input id="breakingInput"><br>
  <label>Lower Third Title:</label><br>
  <input id="titleInput"><br>
  <label>Lower Third Subtitle:</label><br>
  <input id="subInput"><br>
  <label>Ticker Text:</label><br>
  <textarea id="tickerInput"></textarea><br><br>
  <button onclick="updateLive()">Update LIVE TV</button>

  <script defer>
    window.addEventListener('DOMContentLoaded', () => {
      const ws = new WebSocket('wss://de-live-tv-signaling.onrender.com'); // Replace

      ws.onopen = () => console.log("Control panel connected to WebSocket");

      function sendControl(action){
        if(ws.readyState === WebSocket.OPEN){
          ws.send(JSON.stringify({type:'control', action}));
        } else {
          console.log("WebSocket not open yet, retrying...");
          setTimeout(() => sendControl(action), 500);
        }
      }
      window.sendControl = sendControl;

      window.updateLive = () => {
        const breaking = document.getElementById("breakingInput").value;
        const lt_title = document.getElementById("titleInput").value;
        const lt_sub = document.getElementById("subInput").value;
        const ticker = document.getElementById("tickerInput").value;
        updateLiveState({breaking, lt_title, lt_sub, ticker});
        alert("LIVE TV updated!");
      };
    });
  </script>
</body>
</html>
